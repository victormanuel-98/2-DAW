using MauiAppDAW.Views;

namespace MauiAppDAW;

public partial class App : Application
{
    private readonly IServiceProvider? _serviceProvider;

    public App()
    {
        InitializeComponent();
    }

    public App(IServiceProvider serviceProvider) : this()
    {
        _serviceProvider = serviceProvider;
    }

    // Sobrescribimos CreateWindow en lugar de usar MainPage.set
    protected override Window CreateWindow(IActivationState? activationState)
    {
        MainPage mainPage;

        if (_serviceProvider != null)
        {
            mainPage = _serviceProvider.GetService<MainPage>() ?? new MainPage(_serviceProvider.GetService<Services.SwapiService>() ?? new Services.SwapiService(new System.Net.Http.HttpClient { BaseAddress = new Uri("https://swapi.dev/api/") }));
        }
        else
        {
            mainPage = new MainPage(new Services.SwapiService(new System.Net.Http.HttpClient { BaseAddress = new Uri("https://swapi.dev/api/") }));
        }

        var window = new Window(mainPage);
        return window;
    }
}
